{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/react-ssr/","result":{"data":{"site":{"siteMetadata":{"title":"学习随笔"}},"markdownRemark":{"id":"ffa6ed11-1fda-5590-a263-059fd93066fc","excerpt":"当前已经有很多的文章或会议中谈到了服务端渲染这种技术。而且社区中也出现了许多一站式的 React 框架，但是真正想要了解服务端渲染还是需要自己动手实现一下比较好。不过首先我们需要了解什么是服务端渲染和客户端渲染。 JavaScript 革命 浏览器比 5-10 年之前更加先进，我们如今通过客户端 JavaScript…","html":"<p>当前已经有很多的文章或会议中谈到了服务端渲染这种技术。而且社区中也出现了许多一站式的 React 框架，但是真正想要了解服务端渲染还是需要自己动手实现一下比较好。不过首先我们需要了解什么是服务端渲染和客户端渲染。</p>\n<h3>JavaScript 革命</h3>\n<p>浏览器比 5-10 年之前更加先进，我们如今通过客户端 JavaScript 来创建整个网站和 web 应用。我们称之为 <strong>“单页面应用（Single Page Application）”</strong>。这可以使我们创建更加互动性的最新的 web 应用。</p>\n<p>但这种方式存在一个问题，我们初始化的 HTML 不再含有与该 URL 相关的所有数据/内容。</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token doctype\">&lt;!DOCTYPE html></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>My SPA APP Title<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>root<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/bundle.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h3>什么是客户端渲染？（CSR）</h3>\n<p>在浏览器中渲染应用，通常使用 DOM。</p>\n<p>服务器渲染的初始化 HTML 只是一个占位符，整个用户界面和数据都在浏览器的所有脚本加载完成之后渲染。</p>\n<h4>客户端渲染是如何工作的？</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/582713f0d3e3646517ce9b7b81d2448e/01d6c/csr-work.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.63239689181112%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAACFUlEQVQoz3WRy28SQRzH92/x6M1Uo6YakppoEy+eevPgyRg9efF1VC9eWh8xxgMx9VFrBGt5SMUiWGgLyOPQAC2PhZ267G6BXZZ9wczsOMvWtJo4h1++M/l+fvP7zjDkv8seF6itXmnOn9jynq69nTSj54zolPXtrBXzGInzjGOwbZZlWxw3HA6pRggdbqF8ubx098jTG0fDD48ZIU97+WLt63U2eq27Ms24ltm5x/du3+K4VrFYBAD8ATEtSEgr/gvKwgQMnok8m/G/uu9tdV5XQPXjpX048SMV+fTOMg1RkkzT/Gd4W/tlZh5YvlPxJ9Mr3pup2Mt45DlYGsM9DW01esQQD6IepjGmwRwll8zYVX1xwvKdtAIePTjlwCOIRdBA3bpjRfJf/BiT5Z4kCVJHoRsEolp4Rl08PvBPMvuD6R3UbVBVX8tZGnRfkdaBpuXyhc1s/nsildzYLFXZXl8n2MQggfgk47bPs+znQh6IosJxapcPGqRsYgLVPa4cCb5PxT6kk8sbQd966A3g6B12tV/HNnZhUm/zoZ/p3HaZ9Otw0A6PyA60icoN+IpUmS/H7vD5R9nAi9TqXE9pr+1GdjpFyjHueALP5zKZ0WhEdV8d7LaakiBgmxiGsV3KsdVCrZRdWI/OxgNAFBCBCKMDuK+qbLPpHkEIZVnWdd35ZxsjbCOaABOMqXIMnIp5cW9omb8BBrM+KdRPmToAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"csr work\"\n        title=\"csr work\"\n        src=\"/static/582713f0d3e3646517ce9b7b81d2448e/799d3/csr-work.png\"\n        srcset=\"/static/582713f0d3e3646517ce9b7b81d2448e/00d96/csr-work.png 148w,\n/static/582713f0d3e3646517ce9b7b81d2448e/0b23c/csr-work.png 295w,\n/static/582713f0d3e3646517ce9b7b81d2448e/799d3/csr-work.png 590w,\n/static/582713f0d3e3646517ce9b7b81d2448e/2a3d6/csr-work.png 885w,\n/static/582713f0d3e3646517ce9b7b81d2448e/ae92f/csr-work.png 1180w,\n/static/582713f0d3e3646517ce9b7b81d2448e/01d6c/csr-work.png 3346w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<center>常见的客户端渲染模式</center>\n<p><strong>优势</strong></p>\n<ul>\n<li>丰富的页面交互</li>\n<li>初次加载后的快速渲染</li>\n<li>分块实时更新</li>\n<li>更有性价比的部署和扩展</li>\n</ul>\n<p><strong>劣势</strong></p>\n<ul>\n<li>SEO 和索引问题</li>\n<li>bundle.js 加载时间问题</li>\n<li>旧的设备/慢的网络会有性能问题</li>\n<li>社交媒体爬虫和分享问题（SMO）</li>\n</ul>\n<h3>什么是服务端渲染？（SSR）</h3>\n<p>页面加载时服务端返回渲染过的一个页面的整个 HTML。</p>\n<p>对于我们使用的 React 或其他任何 JavaScript 库/框架，服务端渲染是一种在服务器端渲染一个正常的客户端的单页面应用的技术，并返回一个完整的渲染过的页面到浏览器。</p>\n<h4>服务端渲染是如何工作的？</h4>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e30650c36ac88b6af3b705e5f566f2d1/ef11a/ssr-work.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.74626865671641%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAACLElEQVQoz3WSz2sTQRTH8zd47aFUxR8prS0FT0Wl+ANp0IsgilUKKqggFg8Wf/Qilh48FE8WCh4UMYFKFVsL1jQmKmnSNknNpj+Smu7u7G6223HX3U3S3Z3sOJM9RA8Ow5s3X+bD9/He+PD/luvSUK1K/b1LPS1fz+xnLvlLNzsyt7t/DJ5cfXhKHOz0kRcAACbL6LpBcoTQ3zB2bO7c6bHmXUP+pplje6S+ttG7N4afjj5/8kgYOEThqanp61evRebCWYZJJBLlcrnO1txajSSVWJTr7mLbm4WeVi7Q9mzo/p3HwyMDl6VbdXhl7eeHideKxBuGqWmq63nW3T1/BHj44B7XsY/t2j15PjB+sXe67yjob/chF6fWFFuTGqXS083DrG5pXgmevpNMyFcuCAeatg63SCf8/NlW6gxLfFVYJknNskyYo7XApaQU9qxp8KqgLXDMd29B4DjfuRccOUhh17EseZ0kYk4v5vJQhRubHAtEVdWJSFoAikWB5yzLJldOgfFwlAuGjGiEwgVRCM7PL+TXDZmtyMWVbDL26dX3j6HCagbbpqOX3ivVlFbGVa1W3s4szH37ElyMzwKZp/AvQ48xy+F0CpkyNkRFzLHpN58jL1OFRfwbODAfquA0cdU5tL0h82khMzEz+yJbTFNYU1WwyUJF8brlINdxsGGjioP++TX1TTRW4+NC3EaYwpZlSaWSWR8vbsypgXgSbyBhC5JphtlJdYc6/QEEFSmC56mgFQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ssr work\"\n        title=\"ssr work\"\n        src=\"/static/e30650c36ac88b6af3b705e5f566f2d1/799d3/ssr-work.png\"\n        srcset=\"/static/e30650c36ac88b6af3b705e5f566f2d1/00d96/ssr-work.png 148w,\n/static/e30650c36ac88b6af3b705e5f566f2d1/0b23c/ssr-work.png 295w,\n/static/e30650c36ac88b6af3b705e5f566f2d1/799d3/ssr-work.png 590w,\n/static/e30650c36ac88b6af3b705e5f566f2d1/2a3d6/ssr-work.png 885w,\n/static/e30650c36ac88b6af3b705e5f566f2d1/ae92f/ssr-work.png 1180w,\n/static/e30650c36ac88b6af3b705e5f566f2d1/ef11a/ssr-work.png 3350w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<center>常见的服务端渲染模式</center>\n<p><strong>优势</strong></p>\n<ul>\n<li>SEO 一致性</li>\n<li>性能更优，初始化页面加载更快</li>\n<li>社交媒体爬虫和平台配合良好</li>\n</ul>\n<p><strong>劣势</strong></p>\n<ul>\n<li>频繁的请求</li>\n<li>很慢的页面渲染（TTFB — 获取第一个字节的时间）</li>\n<li>复杂的架构（为了统一的方式）</li>\n</ul>\n<h3>谷歌是如何索引的？</h3>\n<p>我们之前提到了单页面应用存在 SEO 的问题。理解谷歌索引系统是如何通过服务端渲染解决此问题很重要，谷歌有两种索引的方式：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ddbd4e7ef2456bbc08128066fa5c81bf/690a9/google-indexing.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.074014481094125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAACoUlEQVQozyWS2VNSARTG7//T9GZjlpOmoKghoo4bCoq2Wj74YJk5ZdPUQw+NNZM4iYQWuCFXuAhBwqgXuEi4xKIsKpdFL5sg4NJluaGeOQ/ffHN+D2e+D+h0QOxteceOpmMbZm5qGWvaelhrDEcJgshks7nNCfVhkA5rmesIy6xnWZfbraoc0uWAgJxq/aMoGf5AHv1SJRTWQspqjakX2cEzF1huEnj6sc5WrdIXffxEGuVUCXh0qbDdrGaZFQBzXdNkWK4QiSjCOdrCb7rCUK+ykCXmedfRFczfDpEklrpfW2VCebkAvAfKauSLDONqm0kNtOi1T4zrA2bHwzU7VWWuVthokJ0idjZI0dh5xhdP0UB3JeisW3SwVlxM2N6hs7KRrSZY34zAQOPK2jPEOmTafa7f7VK72pX7lfN7VXOem3zv5N/kV1O8gO+tmPW0yNC3iP+Fzj1k3H9pdNaqTTkQoKs2+xDXK8Tdr/W+1h0yIB9Z6KMIsMLxUDcU7wSP7/BCpJ9YI3gwuBrohw8GdN5+vbt1yUpXbQC0RVsfjL43YG+0gT5NkA0FqVOhovHI9c8x0IZPbODXhmPFvEjNTKhLFuxWYmyFr0fjfaDeo8qsAHXBlXuvWeJvEGMMcZgNxorGjsnjyWlL5uQfnkimvpvSpdxk3ki0mBe+O4mVCvykaZQi2qVKXED5DFo25Sv9gZXwQ3mcaP5I/N3SOXZCEPGIVmZctQcIIoVGiUHl+W1O4ta3KHkyXC4IVEz7yTMo0CAKFnCDhWNH+Zx4j/TMgmUI4iLhU5czBc9KPRP7Uc9lZFmjN3NffHZj5LiQe3STG2hbCAI7odRTKPEIPFU60unM5VWWuOwVgUcMeMyUvXCyV5XB04TEluoUnfbKE2gs/R+XmNIBUpT2DAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"google indexing\"\n        title=\"google indexing\"\n        src=\"/static/ddbd4e7ef2456bbc08128066fa5c81bf/799d3/google-indexing.png\"\n        srcset=\"/static/ddbd4e7ef2456bbc08128066fa5c81bf/00d96/google-indexing.png 148w,\n/static/ddbd4e7ef2456bbc08128066fa5c81bf/0b23c/google-indexing.png 295w,\n/static/ddbd4e7ef2456bbc08128066fa5c81bf/799d3/google-indexing.png 590w,\n/static/ddbd4e7ef2456bbc08128066fa5c81bf/2a3d6/google-indexing.png 885w,\n/static/ddbd4e7ef2456bbc08128066fa5c81bf/ae92f/google-indexing.png 1180w,\n/static/ddbd4e7ef2456bbc08128066fa5c81bf/690a9/google-indexing.png 2486w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3>如何实现 SSR？</h3>\n<p>让我们来看一下 React 如何实现服务端渲染。</p>\n<h4>方法</h4>\n<ul>\n<li>服务端初始化渲染</li>\n<li>展示全内容 HTML</li>\n<li>JS 执行</li>\n<li>React 接管/重渲染</li>\n</ul>\n<h4>挑战</h4>\n<ul>\n<li>Node.js 中使用 JSX</li>\n<li>服务端使用 Redux</li>\n<li>路由</li>\n<li>补水</li>\n</ul>\n<blockquote>\n<p><strong>补水</strong>\n在客户端启动 JavaScript 来复用服务端渲染的 HTML 的 DOM 树和数据。</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/11eb8e76dccb3e54fb2c633f98fbb424/7b49a/react-rehydration.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.73349339735894%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAABRUlEQVQY001QWU7DMBTMITkFN+AAHIFvfjgBEqgflC5URUUUlYpIUBqcpHHdNEsTp46deAkvpUgdjS15mXnzntX8w5h255W+uPbPr5wkr+GotTmFVBoubx6js8uv7iyzXC9IyVuKbiPnjpEuLxPbpVOnPNi10Fr9UyqlwBBHfPSR5UxaYFbmfpm8s9iWpRe6GL0unBcbTebhp8uY0H+RTgDl0wIiGCuO47YIGEqWkcl20VnbffS9oSQq4oLtUB70cvxE16MsGIr4eTlzO6PhFC1AZTHGjj1LSnF/Twb7ZB5RdTBsJAtS/2HrdtNVbxcMqnS8nHn34+EcO60Ylqh4UVImOJeGVdCb0SXXQqiCaiYaAT90A+Pj2gjTGAUhTaWO4nyf4XC1ifBqg8IYm/ZZA2tCKt8TLmqJfoSzrMnagHldm3ZyzS+6/4aRUXq/rQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"react rehydration\"\n        title=\"react rehydration\"\n        src=\"/static/11eb8e76dccb3e54fb2c633f98fbb424/799d3/react-rehydration.png\"\n        srcset=\"/static/11eb8e76dccb3e54fb2c633f98fbb424/00d96/react-rehydration.png 148w,\n/static/11eb8e76dccb3e54fb2c633f98fbb424/0b23c/react-rehydration.png 295w,\n/static/11eb8e76dccb3e54fb2c633f98fbb424/799d3/react-rehydration.png 590w,\n/static/11eb8e76dccb3e54fb2c633f98fbb424/2a3d6/react-rehydration.png 885w,\n/static/11eb8e76dccb3e54fb2c633f98fbb424/ae92f/react-rehydration.png 1180w,\n/static/11eb8e76dccb3e54fb2c633f98fbb424/7b49a/react-rehydration.png 1666w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3>总结</h3>\n<p>服务端渲染并不是魔法，需要根据商业逻辑来决定要不要采用。</p>\n<h4>什么时候使用单页面应用？</h4>\n<ul>\n<li>网站丰富的交互</li>\n<li>网络很快</li>\n<li>最小服务端资源</li>\n<li>主代码量比较小或采用懒加载</li>\n<li>实时/分部更新</li>\n</ul>\n<h4>什么时候使用服务端渲染？</h4>\n<ul>\n<li>SEO 很重要</li>\n<li>网络比较慢</li>\n<li>足够的服务器资源</li>\n<li>主代码庞大，加载慢</li>\n<li>社交分享比较重要</li>\n</ul>\n<h3>更多</h3>\n<p><a href=\"https://developers.google.com/web/updates/2019/02/rendering-on-the-web\">Rendering on the Web | Web | Google Developers</a></p>\n<p><a href=\"https://medium.com/dev-channel/a-netflix-web-performance-case-study-c0bcde26a9d9\">A Netflix Web Performance Case Study</a></p>\n<p><a href=\"https://github.com/brillout/awesome-universal-rendering\">awesome universal rendering</a></p>\n<h3>参考</h3>\n<p><a href=\"https://itnext.io/server-side-rendering-with-react-redux-and-react-router-fa5b67d4965e?_branch_match_id=755024804793509077&#x26;gi=cd56fb5a4621\">https://itnext.io/server-side-rendering-with-react-redux-and-react-router-fa5b67d4965e?_branch_match_id=755024804793509077&#x26;gi=cd56fb5a4621</a></p>","frontmatter":{"title":"【译】React SSR 初体验","date":"February 09, 2020","description":"SSR 的入门学习"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"tags":["React","SSR"],"slug":"/react-ssr/","previous":{"excerpt":"web 开发者想必都一定听说过 express.js。Express 是 node 中比较受欢迎的轻量的 web 服务器框架。 本文我们将通过分析 express…","fields":{"slug":"/how-expressjs-works/"},"frontmatter":{"date":"February 14, 2020","description":"Express.js 工作原理，部分源码分析","title":"【译】Express.js 工作原理","tags":["express.js"]}},"next":{"excerpt":"generator 函数不同于通常的函数，运行就结束。我们可以任意暂停函数的执行，并在合适时机输出。 通过在  关键字后面添加  创建 generator 函数。 generator 函数与普通函数实际上工作方式完全不同： 调用 generator…","fields":{"slug":"/javascript-visualized-generator-function/"},"frontmatter":{"date":"February 05, 2020","description":"迭代器和迭代函数以图形化的方式展示，方便理解","title":"【译】JavaScript 可视化之迭代器和迭代函数","tags":["JavaScript Visualized","Generator","Iterator"]}}}}}