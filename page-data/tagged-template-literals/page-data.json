{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/tagged-template-literals/","result":{"data":{"site":{"siteMetadata":{"title":"学习随笔"}},"markdownRemark":{"id":"0ec2d32c-f21e-59c7-b15d-899c8659d32d","excerpt":"背景 最近在个人博客中采用了styled-components库来写组件的样式，在翻看文档时，发现用法： 这个用法引起了我的兴趣，这是如何 work 起来的？ 带标签的模板字符串（Tagged Template Literals…","html":"<h2>背景</h2>\n<p>最近在个人博客中采用了<a href=\"https://www.styled-components.com/\">styled-components</a>库来写组件的样式，在翻看文档时，发现用法：</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">import</span> styled <span class=\"token keyword\">from</span> <span class=\"token string\">'styled-components'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> Title <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>h1<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  color: palevioletred;\n  font-size: 18px;\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Title</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Hello World!</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Title</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>这个用法引起了我的兴趣，这是如何 work 起来的？</p>\n<h2>带标签的模板字符串（Tagged Template Literals）</h2>\n<p><code class=\"language-text\">styled.h1</code> 符号其实是模板字符串的一种高级用法，本质上它只是调用了一个函数即 <code class=\"language-text\">styled.h1``\\</code> 和 <code class=\"language-text\">styled.h1()</code> 功能是同样的。不过差异在于两种写法的传参方式。</p>\n<p>我们来看下面简单的例子：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">logArgs</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token operator\">...</span>args</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">logArgs</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// -> a b</span></code></pre></div>\n<p>作为标签模板字符串来调用：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">logArgs<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// -> ['']</span>\n\nlogArgs<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">I like pizza</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// -> ['I like pizza']</span></code></pre></div>\n<p>可以看出，模板字符串方式会把传入的参数以数组来包一层。</p>\n<h3>插值（Interpolations）</h3>\n<p>模板字符串中可以存在插值，如：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> favoriteFood <span class=\"token operator\">=</span> <span class=\"token string\">'pizza'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">logArgs</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">I like </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>favoriteFood<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// -> I like pizza.</span></code></pre></div>\n<p>可以看到，JavaScript 执行时会把变量插入到传入函数参数的字符串中。那在带有标签的模板字符串中使用时有什么表现：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> favoriteFood <span class=\"token operator\">=</span> <span class=\"token string\">'pizza'</span><span class=\"token punctuation\">;</span>\n\nlogArgs<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">I like </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>favoriteFood<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// -> ['I like ', '.'] 'pizza'</span></code></pre></div>\n<p>我们从结果中看到第一个结果还是字符串的数组，里面的元素在插值处分割而插值的内容则作为第二个参数被传递。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/feb005bb1f6d4e45610502e668f9b3c9/5e17e/logargs-explanation.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.57142857142857%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAAA3klEQVQY042Qy27CMBBF8/9/BggsUhWqEJLGJHbs+EWS/cGli+4KiyvNYu7RmSmEEHyeTghx5CBK9rsddV0xtRK3LQmXlhgj3geC94QQ/k3RdRJrNEvqWWLHGBKDS2gf6XNu/o6yGeQdPhf8C2ix2WxprjV3WxLHA602VNrzpSbOKlENkl7XxBCfsJfAdV1IaSbYKhskUi7OMZuEhZtuWN05w6an3VsnO+d+QWZP9CrPEZeLsz3S6SvfNv3ZvQEtjBnRekApiZQtxpr8U4UdPuh6xaVtMKPOy/HluT95ADwav9orQWJ1AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"logargs explanation\"\n        title=\"logargs explanation\"\n        src=\"/static/feb005bb1f6d4e45610502e668f9b3c9/799d3/logargs-explanation.png\"\n        srcset=\"/static/feb005bb1f6d4e45610502e668f9b3c9/00d96/logargs-explanation.png 148w,\n/static/feb005bb1f6d4e45610502e668f9b3c9/0b23c/logargs-explanation.png 295w,\n/static/feb005bb1f6d4e45610502e668f9b3c9/799d3/logargs-explanation.png 590w,\n/static/feb005bb1f6d4e45610502e668f9b3c9/5e17e/logargs-explanation.png 658w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>纯文本的字符串都被存放在第一个参数数组内，随后为插值内容。</p>\n<p>当多于一个插值时：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> favoriteFood <span class=\"token operator\">=</span> <span class=\"token string\">'pizza'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> favoriteDrink <span class=\"token operator\">=</span> <span class=\"token string\">'cola'</span><span class=\"token punctuation\">;</span>\n\nlogArgs<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">I like </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>favoriteFood<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> and </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>favoriteDrink<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// -> ['I like ', ' and ', '.'] 'pizza' 'cola'</span></code></pre></div>\n<p>每个插值都成为函数调用的下一个参数，我们可以有任意多个插值参数。</p>\n<p>与正常的函数调用相比：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> favoriteFood <span class=\"token operator\">=</span> <span class=\"token string\">'pizza'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> favoriteDrink <span class=\"token operator\">=</span> <span class=\"token string\">'cola'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">logArgs</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">I like </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>favoriteFood<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> and </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>favoriteDrink<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// -> I like pizza and cola.</span></code></pre></div>\n<p>所有的插值都混为了一个大字符串。</p>\n<h2>优势</h2>\n<p>这种方式开启了新的探索。以 <code class=\"language-text\">styled-components</code> 为例，我们有一个 <code class=\"language-text\">&lt;Button /&gt;</code> 组件，当 props 传入 <code class=\"language-text\">primary</code> 时期望按钮看起来更大，<code class=\"language-text\">&lt;Button primary /&gt;</code>。\n我们可以如下来实现：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> Button <span class=\"token operator\">=</span> styled<span class=\"token punctuation\">.</span>button<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  font-size: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token parameter\">props</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>primary <span class=\"token operator\">?</span> <span class=\"token string\">'2em'</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">'1em'</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">;\n</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>得到的结果：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// font-size: 2em;</span>\n<span class=\"token operator\">&lt;</span>Button primary <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n\n<span class=\"token comment\">// font-size: 1em;</span>\n<span class=\"token operator\">&lt;</span>Button <span class=\"token operator\">/</span><span class=\"token operator\">></span></code></pre></div>\n<p>让我们再回过来看 <code class=\"language-text\">logArgs</code> 函数。</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">logArgs</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Test </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// -> Test () => console.log('test');</span></code></pre></div>\n<p>这里注意得到的结果为整个字符串，而没有真正的函数。</p>\n<p>当以带标签的模板字符串调用时：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">logArgs<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Test </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'test'</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// ['Test', ''] () => console.log('test')</span></code></pre></div>\n<p>从结果上可能看不出，但这里得到了真正的函数（而不是字符串）。</p>\n<p>这意味着我们可以得到这个函数并且执行它。我们来看一个新的可以执行函数类型参数的函数：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">execFuncArgs</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token operator\">...</span>args</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  args<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">arg</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> arg <span class=\"token operator\">===</span> <span class=\"token string\">'function'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">arg</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>这个函数执行时会执行类型为函数的参数：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">execFuncArgs</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'b'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// -> undefined</span>\n\n<span class=\"token function\">execFuncArgs</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'this is a function'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// -> this is a function</span>\n\n<span class=\"token function\">execFuncArgs</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'another one'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// -> another one</span></code></pre></div>\n<p>我们再来看：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">execFuncArgs</span><span class=\"token punctuation\">(</span>\n  <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Hi, </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Executed!'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// -> undefined</span>\n\nexecFuncArgs<span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Hi, </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Executed!'</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// -> 'Executed!'</span></code></pre></div>\n<p>在带标签的模板字符串中 execFuncArgs 的第二个参数传递的是实际函数，然后继续执行该函数。<code class=\"language-text\">styled-components</code> 底层的实现就是依赖这个特性，在渲染时传入插值函数的 props 可以帮用户来动态更新样式。</p>\n<h2>总结</h2>\n<p>可以看到，JavaScript 的一个新特性就可以实现一个强大的库，为我们的开发带来更好的体验，我们需要不断去探索去总结去实践 JavaScript 实现更多新的能力。</p>\n<h2>参考</h2>\n<p><a href=\"https://mxstbr.blog/2016/11/styled-components-magic-explained/\">https://mxstbr.blog/2016/11/styled-components-magic-explained/</a></p>","frontmatter":{"title":"【译】神奇的模板字符串","date":"December 01, 2019","description":"本文主要介绍了ES6的模板字符串的高级用法"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"tags":["Template Literals","ES6"],"slug":"/tagged-template-literals/","previous":{"excerpt":"简介 现代化的前端应用离不开打包工具，从早期人们所熟知的 Grunt, Gulp 到现在炙手可热的 webpack, rollup 等，这些工具的崛起使得我们的代码构建更加方便，通过 Loader，插件等机制我们可以应用最新的技术，如新语法，预处理 CSS（Scss, Less…","fields":{"slug":"/webpack-behind-the-scene/"},"frontmatter":{"date":"December 04, 2019","description":"本文主要介绍了对webpack的初步认识以及内部的工作原理。","title":"【译】webpack 基本原理","tags":["webpack"]}},"next":{"excerpt":"引言 WebSocket API 是一种较为高级的通信方式，它在客户端和服务端开启一条全双工的通道，可以从客户端发送消息至服务端并且可以接受事件驱动的响应而不需要主动去请求回复。简而言之，收发消息的两端一旦开启通道可相互自由通信。 WebSocket…","fields":{"slug":"/the-websocket-api/"},"frontmatter":{"date":"November 26, 2019","description":"本文主要介绍web应用中Socket编程的相关技术，包括如何实现简单的Socket客户端和服务器","title":"【译】The WebSocket API","tags":["WebSocket"]}}}}}